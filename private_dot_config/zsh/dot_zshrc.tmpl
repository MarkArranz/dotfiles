# vim: ft=zsh

export PATH="$HOME/.local/bin:$PATH"

# Shell options
setopt AUTO_CD              # type directory name to cd into it
setopt INTERACTIVE_COMMENTS # allow comments in interactive shell
setopt GLOB_DOTS            # include dotfiles in glob matches
setopt HIST_VERIFY          # expand history substitutions before executing

# Completion system
autoload -Uz compinit
compinit

# Hyphen-insensitive completion
zstyle ':completion:*' matcher-list 'm:{a-zA-Z-_}={A-Za-z_-}'

# Plugins (fzf-tab after compinit, before widget-wrapping plugins)
source "$HOME/.config/zsh/plugins/fzf-tab/fzf-tab.plugin.zsh"
source "$HOME/.config/zsh/plugins/fzf-tab-source/fzf-tab-source.plugin.zsh"
source "$HOME/.config/zsh/plugins/zsh-autosuggestions/zsh-autosuggestions.zsh"
source "$HOME/.config/zsh/plugins/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh"
ZVM_SYSTEM_CLIPBOARD_ENABLED=true  # must be set before loading zsh-vi-mode
function zvm_after_init() { source <(fzf --zsh) }  # preserve fzf bindings across vi mode switches
source "$HOME/.config/zsh/plugins/zsh-vi-mode/zsh-vi-mode.plugin.zsh"

# fzf-tab config
zstyle ':completion:*:git-checkout:*' sort false
zstyle ':completion:*:descriptions' format '[%d]'
zstyle ':completion:*' list-colors ${(s.:.)LS_COLORS}
zstyle ':completion:*' menu no
zstyle ':fzf-tab:complete:cd:*' fzf-preview 'eza -1 --color=always $realpath'
zstyle ':fzf-tab:*' fzf-flags --color=fg:1,fg+:2 --bind=tab:accept
zstyle ':fzf-tab:*' use-fzf-default-opts yes
zstyle ':fzf-tab:*' switch-group '<' '>'

# Source config files
source "$HOME/.config/zsh/exports.zsh"
source "$HOME/.config/zsh/functions.zsh"
source "$HOME/.config/zsh/aliases.zsh"

# Tool inits
(( $+commands[direnv] )) && eval "$(direnv hook zsh)"
(( $+commands[starship] )) && eval "$(starship init zsh)"

{{- if .forWork }}

# Work NVM:
export NVM_DIR="$HOME/.nvm"
[[ -s "$NVM_DIR/nvm.sh" ]] && \. "$NVM_DIR/nvm.sh"
[[ -s "$NVM_DIR/bash_completion" ]] && \. "$NVM_DIR/bash_completion"

{{- end }}
