export PATH="$HOME/.local/bin:$PATH"

# Shell options
setopt AUTO_CD              # type directory name to cd into it
setopt INTERACTIVE_COMMENTS # allow comments in interactive shell
setopt GLOB_DOTS            # include dotfiles in glob matches
setopt EXTENDED_GLOB        # enable ^ ~ # glob operators

# History behavior
setopt SHARE_HISTORY          # sync history across all open shells
setopt EXTENDED_HISTORY       # save timestamps with each entry
setopt HIST_VERIFY            # expand history substitutions before executing
setopt HIST_IGNORE_ALL_DUPS   # remove older duplicate when new one is added
setopt HIST_IGNORE_SPACE      # prefix with space to exclude from history
setopt HIST_REDUCE_BLANKS     # strip extra whitespace from saved commands
setopt HIST_EXPIRE_DUPS_FIRST # when trimming, remove dupes before unique entries

# Directory stack
setopt AUTO_PUSHD           # cd automatically pushes onto dir stack
setopt PUSHD_IGNORE_DUPS    # don't push duplicate directories
setopt PUSHD_MINUS          # swap +/- so cd -N is more intuitive

# Completion system
autoload -Uz compinit
compinit

# Hyphen-insensitive completion
zstyle ':completion:*' matcher-list 'm:{a-zA-Z-_}={A-Za-z_-}'

# Plugins (fzf-tab after compinit, before widget-wrapping plugins)
[[ -f "$HOME/.config/zsh/plugins/fzf-tab/fzf-tab.plugin.zsh" ]] && \
  source "$HOME/.config/zsh/plugins/fzf-tab/fzf-tab.plugin.zsh"
[[ -f "$HOME/.config/zsh/plugins/fzf-tab-source/fzf-tab-source.plugin.zsh" ]] && \
  source "$HOME/.config/zsh/plugins/fzf-tab-source/fzf-tab-source.plugin.zsh"
[[ -f "$HOME/.config/zsh/plugins/zsh-autosuggestions/zsh-autosuggestions.zsh" ]] && \
  source "$HOME/.config/zsh/plugins/zsh-autosuggestions/zsh-autosuggestions.zsh"
[[ -f "$HOME/.config/zsh/plugins/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh" ]] && \
  source "$HOME/.config/zsh/plugins/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh"
ZVM_SYSTEM_CLIPBOARD_ENABLED=true  # must be set before loading zsh-vi-mode
function zvm_after_init() { (( $+commands[fzf] )) && source <(fzf --zsh) }
if [[ -f "$HOME/.config/zsh/plugins/zsh-vi-mode/zsh-vi-mode.plugin.zsh" ]]; then
  source "$HOME/.config/zsh/plugins/zsh-vi-mode/zsh-vi-mode.plugin.zsh"
else
  # zsh-vi-mode absent â€” source fzf bindings directly since zvm_after_init won't fire
  (( $+commands[fzf] )) && source <(fzf --zsh)
fi

# fzf-tab config
zstyle ':completion:*:git-checkout:*' sort false
zstyle ':completion:*:descriptions' format '[%d]'
zstyle ':completion:*' list-colors ${(s.:.)LS_COLORS}
zstyle ':completion:*' menu no
zstyle ':fzf-tab:complete:cd:*' fzf-preview 'command -v eza >/dev/null && eza -1 --color=always $realpath || ls -1 $realpath'
zstyle ':fzf-tab:*' fzf-flags --color=fg:1,fg+:2 --bind=tab:accept
zstyle ':fzf-tab:*' use-fzf-default-opts yes
zstyle ':fzf-tab:*' switch-group '<' '>'

# Source config files
source "$HOME/.config/zsh/exports.zsh"
source "$HOME/.config/zsh/functions.zsh"
source "$HOME/.config/zsh/aliases.zsh"

# List directory contents on cd (must be after aliases so 'l' is expanded)
chpwd() { l }

# Tool inits
(( $+commands[direnv] )) && eval "$(direnv hook zsh)"
(( $+commands[starship] )) && eval "$(starship init zsh)"

{{- if .forWork }}

# Work NVM:
export NVM_DIR="$HOME/.nvm"
[[ -s "$NVM_DIR/nvm.sh" ]] && \. "$NVM_DIR/nvm.sh"
[[ -s "$NVM_DIR/bash_completion" ]] && \. "$NVM_DIR/bash_completion"

{{- end }}


# vim: ft=zsh