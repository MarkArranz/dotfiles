#!/bin/bash
# Chezmoi modify_ script for ~/.config/opencode/opencode.json
#
# Manages: plugin array (adds opencode-notifier plugin)
# Preserves: $schema, provider, and all other keys

current=$(cat)

# If the file doesn't exist yet, start with empty object
if [ -z "$current" ]; then
  current='{}'
fi

# Plugin entry to add (idempotently)
plugin_entry="@markarranz/opencode-focus-notify@latest"

# Add plugin entry to .plugin array only if not already present
echo "$current" | jq --arg entry "$plugin_entry" \
  'if (.plugin // [] | index($entry)) != null then . else .plugin += [$entry] end'
